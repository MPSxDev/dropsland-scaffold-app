# Vercel Build Fix

## Problem

Vercel builds were failing with TypeScript errors:

```
error TS2307: Cannot find module 'dj_fungible' or its corresponding type declarations.
error TS2307: Cannot find module 'factory' or its corresponding type declarations.
```

## Root Cause

1. The Soroban contract TypeScript clients live in `packages/*` (workspace packages)
2. These packages are generated by `stellar-scaffold build --build-clients` (a Rust CLI tool)
3. The packages were gitignored, so Vercel didn't have access to them
4. Vercel doesn't support Rust/Cargo installations by default

## Solution Applied

### 1. Updated `.gitignore`

- Commented out `packages/*` exclusion
- Commented out `src/contracts/*` exclusion
- Added notes explaining why these generated files are now committed

### 2. Updated `package.json` build script

Changed from:

```json
"build": "tsc -b && vite build"
```

To:

```json
"build": "npm run build --workspace=packages && tsc -b && vite build"
```

This ensures workspace packages are built before the main app.

## Steps to Deploy

### 1. Commit the Generated Packages

```bash
# Add the packages to git
git add packages/
git add src/contracts/

# Verify what's being added
git status

# Commit the changes
git commit -m "fix: commit generated contract clients for Vercel deployment"
```

### 2. Push to Your Repository

```bash
git push origin main
```

### 3. Redeploy on Vercel

Vercel should automatically trigger a new deployment. The build should now succeed.

## Alternative Solutions (Not Recommended)

### Option A: Custom Vercel Build Image

Create a custom Docker image with Rust and stellar-scaffold installed. This is complex and overkill for most projects.

### Option B: Generate Before Deploy

Use a pre-push hook to regenerate packages. This is error-prone and doesn't work well with CI/CD.

## Maintenance Notes

- When you update contracts, regenerate the packages locally:

  ```bash
  stellar contract build
  stellar scaffold build --build-clients
  npm run install:contracts
  ```

- Commit the updated packages:
  ```bash
  git add packages/ src/contracts/
  git commit -m "chore: update contract clients"
  ```

## Verifying the Fix

After deployment, check:

1. ✅ Build logs show no TypeScript errors
2. ✅ All contract imports resolve correctly
3. ✅ The app loads without module errors

## Related Files Modified

- `.gitignore` - Uncommented packages and contract client exclusions
- `package.json` - Updated build script to build workspace packages first
